<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:ArslanProjectManager.MobileUI.ViewModels"
             xmlns:dto="clr-namespace:ArslanProjectManager.Core.DTOs;assembly=ArslanProjectManager.Core"
             x:Class="ArslanProjectManager.MobileUI.Views.ProjectsPage"
             x:DataType="models:ProjectsViewModel"
             Title="Projects"
             BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
    <Grid RowDefinitions="Auto,*">
        <!-- Header with Search and Create Button -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Padding="20,18,20,8">
            <SearchBar Grid.Column="0"
                      Placeholder="Search projects..."
                      HorizontalOptions="Fill"
                      Text="{Binding SearchText, Mode=TwoWay}"/>
            <Button Grid.Column="1"
                    WidthRequest="50"
                    HeightRequest="50"
                    CornerRadius="25"
                    Style="{StaticResource PrimaryButton}"
                    Text="&#xf067;"
                    FontFamily="FA"
                    Command="{Binding CreateProjectCommand}"/>
        </Grid>
        <!-- Projects List -->
        <ScrollView Grid.Row="1">
            <CollectionView x:Name="ProjectsList" Margin="20,0,20,0" ItemsSource="{Binding Projects}"> <!-- SelectionMode="Single" SelectionChanged="OnProjectSelected" -->
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="16"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:UserProjectDto">
                        <Border Stroke="{AppThemeBinding Light={StaticResource CardBorderLight}, Dark={StaticResource CardBorderDark}}"
                                StrokeThickness="2"
                                StrokeShape="RoundRectangle 14"
                                BackgroundColor="{AppThemeBinding Light={StaticResource CardBackgroundLight}, Dark={StaticResource CardBackgroundDark}}"
                                Margin="0,8">
                            <VerticalStackLayout Padding="18" Spacing="12">
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <Label Grid.Column="0" Text="&#xf542;" Style="{StaticResource FontAwesomeIcon}" VerticalOptions="Center"/>
                                    <Label Grid.Column="1" Text="{Binding ProjectName}" Style="{StaticResource AccentLabelStyle}" VerticalOptions="Center"/>
                                </Grid>
                                <Label Text="{Binding Description}" FontSize="15" TextColor="{AppThemeBinding Light={StaticResource Gray800}, Dark={StaticResource Gray200}}"/>
                                <HorizontalStackLayout Spacing="10" Margin="0,4,0,0">
                                    <Border BackgroundColor="{AppThemeBinding Light={StaticResource Blue700}, Dark={StaticResource Cyan800}}" Padding="10,3" StrokeShape="RoundRectangle 8">
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="5">
                                            <Label Grid.Column="0" Text="&#xf0c0;" Style="{StaticResource FontAwesomeIconSmall}" TextColor="White" VerticalOptions="Center"/>
                                            <Label Grid.Column="1" Text="{Binding TeamName, StringFormat='{0}'}" FontSize="13" TextColor="{AppThemeBinding Light={StaticResource Black}, Dark=White}" VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                    <Border  BackgroundColor="{AppThemeBinding Light={StaticResource Cyan700}, Dark={StaticResource Cyan400}}" Padding="10,3" StrokeShape="RoundRectangle 8">
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="5">
                                            <Label Grid.Column="0" Text="&#xf0ae;" Style="{StaticResource FontAwesomeIconSmall}" TextColor="White" VerticalOptions="Center"/>
                                            <Label Grid.Column="1" Text="{Binding TaskCount, StringFormat='{0}'}" FontSize="13" TextColor="{AppThemeBinding Light={StaticResource Black}, Dark=White}" VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                    <Border BackgroundColor="{AppThemeBinding Light={StaticResource Green700}, Dark={StaticResource Green400}}" Padding="10,3" StrokeShape="RoundRectangle 8">
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="5">
                                            <Label Grid.Column="0" Text="&#xf00c;" Style="{StaticResource FontAwesomeIconSmall}" TextColor="White" VerticalOptions="Center"/>
                                            <Label Grid.Column="1" Text="{Binding CompletedTaskCount, StringFormat='{0}'}" FontSize="13" TextColor="{AppThemeBinding Light={StaticResource Black}, Dark=White}" VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>
    </Grid>
</ContentPage>