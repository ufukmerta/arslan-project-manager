<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:ArslanProjectManager.MobileUI.ViewModels"
             x:Class="ArslanProjectManager.MobileUI.Views.ProfilePage"
             x:DataType="models:ProfileViewModel"
             Title="Profile"
             BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">
            
            <!-- Profile Header -->
            <Border Style="{StaticResource CardFrameStyle}" Padding="20" Margin="0,10,0,0">
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
                    <Border Grid.RowSpan="2"
                           StrokeShape="Ellipse"
                           HeightRequest="100" 
                           WidthRequest="100"
                           Padding="0"
                           Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                           StrokeThickness="2">
                        <Image Source="{Binding ProfileImage}"
                               Aspect="AspectFill"/>
                    </Border>
                    <VerticalStackLayout Grid.Column="1" 
                                        Margin="15,0,0,0"
                                        VerticalOptions="Center">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="&#xf007;" Style="{StaticResource FontAwesomeIcon}" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="{Binding FullName}" Style="{StaticResource TitleLabelStyle}" VerticalOptions="Center"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="&#xf0e0;" Style="{StaticResource FontAwesomeIcon}" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="{Binding Email}" Style="{StaticResource BodyLabelStyle}" VerticalOptions="Center"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="&#xf0c0;" Style="{StaticResource FontAwesomeIcon}" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="{Binding Role}" TextColor="{StaticResource Success}" VerticalOptions="Center"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="&#xf133;" Style="{StaticResource FontAwesomeIcon}" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Text="{Binding RegisterDate, StringFormat='Registered: {0}'}" Style="{StaticResource BodyLabelStyle}" FontSize="12" VerticalOptions="Center"/>
                        </Grid>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Statistics -->
            <Border Style="{StaticResource CardFrameStyle}" Padding="20">
                <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                    <VerticalStackLayout Grid.Column="0">
                        <Label Text="&#xf542;" Style="{StaticResource FontAwesomeIconLarge}" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenProjectsCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="Projects" Style="{StaticResource AccentLabelStyle}" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenProjectsCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="{Binding ProjectCount}" Style="{StaticResource TitleLabelStyle}" FontSize="28" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenProjectsCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="{Binding CompletedProjects, StringFormat='Completed: {0}'}" Style="{StaticResource BodyLabelStyle}" HorizontalOptions="Center" FontSize="12" TextColor="{StaticResource Success}"/>
                    </VerticalStackLayout>
                    <VerticalStackLayout Grid.Column="1">
                        <Label Text="&#xf0ae;" Style="{StaticResource FontAwesomeIconLarge}" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenTasksCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="Tasks" Style="{StaticResource AccentLabelStyle}" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenTasksCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="{Binding TaskCount}" Style="{StaticResource TitleLabelStyle}" FontSize="28" HorizontalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenTasksCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                        <Label Text="{Binding CompletedTasks, StringFormat='Completed: {0}'}" Style="{StaticResource BodyLabelStyle}" HorizontalOptions="Center" FontSize="12" TextColor="{StaticResource Success}"/>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Settings Buttons -->
            <Grid ColumnSpacing="15" Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Command="{Binding EditProfileCommand}"
                        Text="Edit Profile"
                        Style="{StaticResource SecondaryButton}">
                    <Button.ImageSource>
                        <FontImageSource Glyph="&#xf044;"
                             FontFamily="FA"
                             Size="20"
                             Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Accent}}" />
                    </Button.ImageSource>
                </Button>

                <Button Grid.Column="1"
                        Command="{Binding OpenInvitationsCommand}"
                        Text="My Invitations"
                        Style="{StaticResource PrimaryButton}">
                    <Button.ImageSource>
                        <FontImageSource Glyph="&#xf0e0;"
                             FontFamily="FA"
                             Size="20"
                             Color="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource White}}" />
                    </Button.ImageSource>
                </Button>
            </Grid>

            <!-- Logout Button -->
            <Button Command="{Binding LogoutCommand}"
                    Text="Logout"
                    Style="{StaticResource DangerButton}"
                    Margin="0,10,0,10">
                <Button.ImageSource>
                    <FontImageSource Glyph="&#xf08b;"
                         FontFamily="FA"
                         Size="20"
                         Color="White" />
                </Button.ImageSource>
            </Button>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>